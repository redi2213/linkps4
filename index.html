<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PS4 MediaFire Link Extractor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; max-width: 600px; }
    #result { margin-top: 20px; background: white; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>PS4 MediaFire Link Extractor</h1>

<p style="color: red; font-weight: bold;">
⚠️ Before using, please visit 
<a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">this page</a> 
and click "Request temporary access".
</p>

<label for="urlInput">Enter the game page URL:</label>
<input type="text" id="urlInput" placeholder="e.g. https://dlpsgame.com/your-game-link" />
<button id="fetchBtn">Extract MediaFire Links</button>

<div id="result"></div>

<script>
async function fetchMediafireLinks() {
  const urlInput = document.getElementById('urlInput').value.trim();
  const resultDiv = document.getElementById('result');
  if (!urlInput) return resultDiv.innerHTML = '<span class="error">❌ Please enter a valid URL.</span>';

  resultDiv.textContent = "⏳ Fetching MediaFire links...";
  const proxyUrl = 'https://cors-anywhere.herokuapp.com/' + urlInput;

  try {
    const response = await fetch(proxyUrl);
    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
    const html = await response.text();
    const doc = new DOMParser().parseFromString(html, 'text/html');

    const links = [...doc.querySelectorAll('a[href*="mediafire.com/file"]')];
    if (!links.length) return resultDiv.textContent = '❌ No MediaFire links found.';

    let output = '✅ MediaFire links found:\n\n';

    links.forEach((a, i) => {
      let title = "Unknown Title";
      let cusa = "CUSA????";

      const wrapper = a.closest('li, p');
      if (wrapper) {
        const rawText = wrapper.textContent.trim();

        if (/backport/i.test(rawText)) title = "Backport / Fix";
        else if (/update/i.test(rawText)) title = "Update";
        else if (/v\d+\.\d+/i.test(rawText)) title = "Base Game";
        else title = "Game";

        const matchCUSA = rawText.match(/CUSA\d+/i);
        if (matchCUSA) cusa = matchCUSA[0].toUpperCase();
      }

      if (cusa === "CUSA????") {
        const url = a.href;
        const matchInLink = url.match(/[_\-](\d{5})[_\-]/);
        if (matchInLink) cusa = "CUSA" + matchInLink[1];
      }

      output += `[${i + 1}] ${title} — ${cusa}\n${a.href}\n\n`;
    });

    resultDiv.textContent = output;

  } catch (err) {
    resultDiv.innerHTML = `<span class="error">❌ Error fetching links: ${err.message}</span>`;
  }
}

document.getElementById('fetchBtn').addEventListener('click', fetchMediafireLinks);
</script>

</body>
</html>
