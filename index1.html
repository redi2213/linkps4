<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PS4 MediaFire Link Extractor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; direction: ltr; }
    input, button { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; max-width: 600px; }
    #result { margin-top: 20px; background: white; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Extract MediaFire Links from PS4 Game Page</h1>

  <p>
    Before using this tool, please visit and click “Request temporary access”:<br>
    <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">https://cors-anywhere.herokuapp.com/corsdemo</a>
  </p>

  <label for="urlInput">Enter Game Page URL:</label>
  <input type="text" id="urlInput" placeholder="e.g. https://dlpsgame.com/..." />
  <button id="fetchBtn">Extract Links</button>

  <div id="result"></div>

  <script>
    async function fetchMediafireLinks() {
      const url = document.getElementById('urlInput').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = "⏳ Fetching...";
      if (!url) {
        resultDiv.innerHTML = '<span class="error">❌ Please enter a valid URL.</span>';
        return;
      }

      const proxyUrl = 'https://cors-anywhere.herokuapp.com/' + url;

      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const links = [...doc.querySelectorAll('a[href*="mediafire.com/file/"]')];
        if (links.length === 0) {
          resultDiv.innerHTML = '❌ No MediaFire links found.';
          return;
        }

        let output = `✅ MediaFire links found:\n\n`;

        links.forEach((a, i) => {
          let title = "Unknown Title";
          let cusa = "CUSA????";

          const wrapper = a.closest('li, p');
          if (wrapper) {
            const rawText = wrapper.textContent.trim();

            // Get title from before :
            const titleMatch = rawText.match(/^(.{4,80}?):/);
            if (titleMatch) {
              title = titleMatch[1].trim();
            } else if (/backport/i.test(rawText)) {
              title = "Backport / Fix";
            } else if (/update/i.test(rawText)) {
              title = "Update";
            } else if (/v\d+\.\d+/i.test(rawText)) {
              title = "Base Game";
            } else {
              title = "Game";
            }

            const matchCUSA = rawText.match(/CUSA\d+/i);
            if (matchCUSA) cusa = matchCUSA[0].toUpperCase();
          }

          if (cusa === "CUSA????") {
            const url = a.href;
            const matchInLink = url.match(/[_\-](\d{5})[_\-]/);
            if (matchInLink) cusa = "CUSA" + matchInLink[1];
          }

          output += `[${i + 1}] ${title} — ${cusa}\n${a.href}\n\n`;
        });

        resultDiv.textContent = output;
      } catch (e) {
        resultDiv.innerHTML = `<span class="error">❌ Error fetching or parsing: ${e.message}</span>`;
      }
    }

    document.getElementById('fetchBtn').addEventListener('click', fetchMediafireLinks);
  </script>

</body>
</html>
