<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PS4 MediaFire Link Extractor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; direction: ltr; }
    input, button { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; max-width: 600px; }
    #result, #outputLinks { margin-top: 20px; background: white; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
    .error { color: red; font-weight: bold; }
    .link-item { margin-bottom: 12px; }
  </style>
</head>
<body>

  <h1>Extract MediaFire Links from PS4 Game Page</h1>

  <p>
    Before using this tool, please visit and click ‚ÄúRequest temporary access‚Äù:<br>
    <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">https://cors-anywhere.herokuapp.com/corsdemo</a>
  </p>

  <label for="urlInput">Enter Game Page URL:</label>
  <input type="text" id="urlInput" placeholder="e.g. https://dlpsgame.com/..." />
  <button id="fetchBtn">Extract Links</button>

  <div id="result"></div>

  <button id="copyBtn" style="display:none;">üìã Copy Selected Links</button>
  <button id="downloadBtn" style="display:none;">üíæ Download .txt</button>

  <div id="outputLinks" style="display:none;"></div>

  <script>
    let extractedLinks = [];

    async function fetchMediafireLinks() {
      const url = document.getElementById('urlInput').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = "‚è≥ Fetching...";
      extractedLinks = [];

      document.getElementById('copyBtn').style.display = "none";
      document.getElementById('downloadBtn').style.display = "none";
      document.getElementById('outputLinks').style.display = "none";
      document.getElementById('outputLinks').textContent = "";

      if (!url) {
        resultDiv.innerHTML = '<span class="error">‚ùå Please enter a valid URL.</span>';
        return;
      }

      const proxyUrl = 'https://cors-anywhere.herokuapp.com/' + url;

      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const links = [...doc.querySelectorAll('a[href*="mediafire.com/file/"]')];
        if (links.length === 0) {
          resultDiv.innerHTML = '‚ùå No MediaFire links found.';
          return;
        }

        let outputHTML = `<strong>‚úÖ MediaFire links found:</strong><br><br>`;

        links.forEach((a, i) => {
          let title = "Unknown";
          let cusa = "CUSA????";

          const wrapper = a.closest('li, p');
          if (wrapper) {
            const rawText = wrapper.textContent.trim();

            const titleMatch = rawText.match(/^(.{4,80}?):/);
            if (titleMatch) {
              title = titleMatch[1].trim();
            } else if (/backport/i.test(rawText)) {
              title = "Backport / Fix";
            } else if (/update/i.test(rawText)) {
              title = "Update";
            } else if (/v\d+\.\d+/i.test(rawText)) {
              title = "Base Game";
            } else {
              title = "Game";
            }

            const matchCUSA = rawText.match(/CUSA\d+/i);
            if (matchCUSA) cusa = matchCUSA[0].toUpperCase();
          }

          if (cusa === "CUSA????") {
            const url = a.href;
            const matchInLink = url.match(/[_\-](\d{5})[_\-]/);
            if (matchInLink) cusa = "CUSA" + matchInLink[1];
          }

          const label = `${title} ‚Äî ${cusa}`;
          const link = a.href;

          extractedLinks.push({ label, link });

          outputHTML += `
            <div class="link-item">
              <label>
                <input type="checkbox" data-index="${i}" />
                [${i + 1}] ${label}<br>${link}
              </label>
            </div>`;
        });

        resultDiv.innerHTML = outputHTML;

        document.getElementById('copyBtn').style.display = "inline-block";
        document.getElementById('downloadBtn').style.display = "inline-block";
      } catch (e) {
        resultDiv.innerHTML = `<span class="error">‚ùå Error fetching or parsing: ${e.message}</span>`;
      }
    }

    function copySelectedLinks() {
      const checkboxes = document.querySelectorAll('#result input[type="checkbox"]:checked');
      if (checkboxes.length === 0) return;

      const selected = Array.from(checkboxes).map(cb => {
        const { label, link } = extractedLinks[cb.dataset.index];
        return `[${parseInt(cb.dataset.index) + 1}] ${label}\n${link}\n`;
      });

      const text = selected.join('\n');
      navigator.clipboard.writeText(text);
      document.getElementById('outputLinks').style.display = "block";
      document.getElementById('outputLinks').textContent = text;
    }

    function downloadTxt() {
      const checkboxes = document.querySelectorAll('#result input[type="checkbox"]:checked');
      if (checkboxes.length === 0) return;

      const selected = Array.from(checkboxes).map(cb => {
        const { label, link } = extractedLinks[cb.dataset.index];
        return `[${parseInt(cb.dataset.index) + 1}] ${label}\n${link}\n`;
      });

      const blob = new Blob([selected.join('\n')], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ps4_links.txt";
      a.click();
    }

    document.getElementById('fetchBtn').addEventListener('click', fetchMediafireLinks);
    document.getElementById('copyBtn').addEventListener('click', copySelectedLinks);
    document.getElementById('downloadBtn').addEventListener('click', downloadTxt);
  </script>

</body>
</html>
