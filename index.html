<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>استخراج لینک مدیافایر - PS4 Link Extractor</title>
<style>
  body { font-family: Tahoma, sans-serif; padding: 20px; background: #f0f0f0; }
  input, button { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; max-width: 600px; }
  #result { margin-top: 20px; background: white; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
  .error { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>استخراج لینک‌های MediaFire از صفحه بازی</h1>

<label for="urlInput">لینک صفحه بازی را وارد کنید:</label>
<input type="text" id="urlInput" placeholder="مثلاً https://dlpsgame.com/freddy-spaghetti-ps4-pkg/" />
<button id="fetchBtn">استخراج لینک‌ها</button>

<div id="result"></div>

<script>
  async function fetchMediafireLinks() {
    const url = document.getElementById('urlInput').value.trim();
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = "⏳ در حال دریافت لینک‌ها...";
    if (!url) {
      resultDiv.innerHTML = '<span class="error">❌ لطفاً یک لینک معتبر وارد کنید.</span>';
      return;
    }

    // استفاده از cors-anywhere پروکسی (قبلش برید و دسترسی بگیرید: https://cors-anywhere.herokuapp.com/corsdemo)
    const proxyUrl = 'https://cors-anywhere.herokuapp.com/' + url;

    try {
      const response = await fetch(proxyUrl);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const text = await response.text();

      // استخراج لینک‌ها با regex از متن html
      const mediafireRegex = /https?:\/\/www\.mediafire\.com\/file\/[^\s"'<>]+/g;
      const foundLinks = [...new Set(text.match(mediafireRegex))]; // حذف تکراری ها

      if (foundLinks.length === 0) {
        resultDiv.innerHTML = '❌ هیچ لینک MediaFire پیدا نشد.';
        return;
      }

      // حالا سعی می‌کنیم label ها رو هم استخراج کنیم ساده با یافتن خطوط اطراف لینک
      // چون HTML کامل نیست در fetch نمی‌تونیم از DOM استفاده کنیم، پس یک روش ساده regex داریم

      // یک تابع کمکی برای یافتن label ها در متن (با خطوط اطراف لینک)
      function extractLabel(link) {
        // جستجو برای خط قبل از لینک که ممکنه label باشه
        const index = text.indexOf(link);
        if (index === -1) return "بدون عنوان";
        // حدود 100 کاراکتر قبل از لینک رو میگیریم
        const before = text.substring(Math.max(0, index - 100), index);
        // سعی میکنیم آخرین خط قبل از لینک رو به عنوان label برگردانیم
        const lines = before.split('\n');
        for (let i = lines.length -1; i >= 0; i--) {
          const line = lines[i].trim();
          if (line.length > 0 && !line.includes('<a') && !line.includes('href')) return line;
        }
        return "بدون عنوان";
      }

      let output = `✅ لینک‌های MediaFire پیدا شده:\n\n`;
      foundLinks.forEach((link, i) => {
        output += `[${i+1}] ${extractLabel(link)}\n${link}\n\n`;
      });

      resultDiv.textContent = output;

    } catch (e) {
      resultDiv.innerHTML = `<span class="error">❌ خطا در دریافت یا پردازش لینک‌ها: ${e.message}</span>`;
    }
  }

  document.getElementById('fetchBtn').addEventListener('click', fetchMediafireLinks);
</script>

</body>
</html>
